"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var te=require("@walletconnect/sign-client"),l=require("@walletconnect/utils"),re=require("@walletconnect/logger"),se=require("@walletconnect/jsonrpc-http-connection"),g=require("@walletconnect/jsonrpc-provider"),ie=require("@walletconnect/jsonrpc-utils"),st=require("events");function G(r){return r&&typeof r=="object"&&"default"in r?r:{default:r}}var it=G(te),$=G(se),at=G(st);const ae="error",nt="wss://relay.walletconnect.org",ot="wc",ct="universal_provider",ne=`${ot}@2:${ct}:`,oe="https://rpc.walletconnect.org/v1/",w="generic",ht=`${oe}bundler`,m={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pt(){this.__data__=[],this.size=0}var ut=pt;function dt(r,e){return r===e||r!==r&&e!==e}var S=dt,lt=S;function vt(r,e){for(var t=r.length;t--;)if(lt(r[t][0],e))return t;return-1}var N=vt,ft=N,mt=Array.prototype,gt=mt.splice;function Pt(r){var e=this.__data__,t=ft(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():gt.call(e,t,1),--this.size,!0}var $t=Pt,bt=N;function _t(r){var e=this.__data__,t=bt(e,r);return t<0?void 0:e[t][1]}var wt=_t,yt=N;function Ct(r){return yt(this.__data__,r)>-1}var It=Ct,Ot=N;function At(r,e){var t=this.__data__,s=Ot(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}var Ht=At,Et=ut,jt=$t,St=wt,Nt=It,Tt=Ht;function y(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}y.prototype.clear=Et,y.prototype.delete=jt,y.prototype.get=St,y.prototype.has=Nt,y.prototype.set=Tt;var T=y,Dt=T;function qt(){this.__data__=new Dt,this.size=0}var Rt=qt;function xt(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var Lt=xt;function Ut(r){return this.__data__.get(r)}var Mt=Ut;function Ft(r){return this.__data__.has(r)}var Gt=Ft,zt=typeof j=="object"&&j&&j.Object===Object&&j,ce=zt,Jt=ce,kt=typeof self=="object"&&self&&self.Object===Object&&self,Bt=Jt||kt||Function("return this")(),C=Bt,Vt=C,Kt=Vt.Symbol,he=Kt,pe=he,ue=Object.prototype,Xt=ue.hasOwnProperty,Wt=ue.toString,H=pe?pe.toStringTag:void 0;function Yt(r){var e=Xt.call(r,H),t=r[H];try{r[H]=void 0;var s=!0}catch{}var i=Wt.call(r);return s&&(e?r[H]=t:delete r[H]),i}var Zt=Yt,Qt=Object.prototype,er=Qt.toString;function tr(r){return er.call(r)}var rr=tr,de=he,sr=Zt,ir=rr,ar="[object Null]",nr="[object Undefined]",le=de?de.toStringTag:void 0;function or(r){return r==null?r===void 0?nr:ar:le&&le in Object(r)?sr(r):ir(r)}var D=or;function cr(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var b=cr,hr=D,pr=b,ur="[object AsyncFunction]",dr="[object Function]",lr="[object GeneratorFunction]",vr="[object Proxy]";function fr(r){if(!pr(r))return!1;var e=hr(r);return e==dr||e==lr||e==ur||e==vr}var z=fr,mr=C,gr=mr["__core-js_shared__"],Pr=gr,J=Pr,ve=function(){var r=/[^.]+$/.exec(J&&J.keys&&J.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function $r(r){return!!ve&&ve in r}var br=$r,_r=Function.prototype,wr=_r.toString;function yr(r){if(r!=null){try{return wr.call(r)}catch{}try{return r+""}catch{}}return""}var Cr=yr,Ir=z,Or=br,Ar=b,Hr=Cr,Er=/[\\^$.*+?()[\]{}|]/g,jr=/^\[object .+?Constructor\]$/,Sr=Function.prototype,Nr=Object.prototype,Tr=Sr.toString,Dr=Nr.hasOwnProperty,qr=RegExp("^"+Tr.call(Dr).replace(Er,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Rr(r){if(!Ar(r)||Or(r))return!1;var e=Ir(r)?qr:jr;return e.test(Hr(r))}var xr=Rr;function Lr(r,e){return r?.[e]}var Ur=Lr,Mr=xr,Fr=Ur;function Gr(r,e){var t=Fr(r,e);return Mr(t)?t:void 0}var k=Gr,zr=k,Jr=C,kr=zr(Jr,"Map"),fe=kr,Br=k,Vr=Br(Object,"create"),q=Vr,me=q;function Kr(){this.__data__=me?me(null):{},this.size=0}var Xr=Kr;function Wr(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var Yr=Wr,Zr=q,Qr="__lodash_hash_undefined__",es=Object.prototype,ts=es.hasOwnProperty;function rs(r){var e=this.__data__;if(Zr){var t=e[r];return t===Qr?void 0:t}return ts.call(e,r)?e[r]:void 0}var ss=rs,is=q,as=Object.prototype,ns=as.hasOwnProperty;function os(r){var e=this.__data__;return is?e[r]!==void 0:ns.call(e,r)}var cs=os,hs=q,ps="__lodash_hash_undefined__";function us(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=hs&&e===void 0?ps:e,this}var ds=us,ls=Xr,vs=Yr,fs=ss,ms=cs,gs=ds;function I(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}I.prototype.clear=ls,I.prototype.delete=vs,I.prototype.get=fs,I.prototype.has=ms,I.prototype.set=gs;var Ps=I,ge=Ps,$s=T,bs=fe;function _s(){this.size=0,this.__data__={hash:new ge,map:new(bs||$s),string:new ge}}var ws=_s;function ys(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var Cs=ys,Is=Cs;function Os(r,e){var t=r.__data__;return Is(e)?t[typeof e=="string"?"string":"hash"]:t.map}var R=Os,As=R;function Hs(r){var e=As(this,r).delete(r);return this.size-=e?1:0,e}var Es=Hs,js=R;function Ss(r){return js(this,r).get(r)}var Ns=Ss,Ts=R;function Ds(r){return Ts(this,r).has(r)}var qs=Ds,Rs=R;function xs(r,e){var t=Rs(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}var Ls=xs,Us=ws,Ms=Es,Fs=Ns,Gs=qs,zs=Ls;function O(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}O.prototype.clear=Us,O.prototype.delete=Ms,O.prototype.get=Fs,O.prototype.has=Gs,O.prototype.set=zs;var Js=O,ks=T,Bs=fe,Vs=Js,Ks=200;function Xs(r,e){var t=this.__data__;if(t instanceof ks){var s=t.__data__;if(!Bs||s.length<Ks-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new Vs(s)}return t.set(r,e),this.size=t.size,this}var Ws=Xs,Ys=T,Zs=Rt,Qs=Lt,ei=Mt,ti=Gt,ri=Ws;function A(r){var e=this.__data__=new Ys(r);this.size=e.size}A.prototype.clear=Zs,A.prototype.delete=Qs,A.prototype.get=ei,A.prototype.has=ti,A.prototype.set=ri;var si=A,ii=k,ai=function(){try{var r=ii(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Pe=ai,$e=Pe;function ni(r,e,t){e=="__proto__"&&$e?$e(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var B=ni,oi=B,ci=S;function hi(r,e,t){(t!==void 0&&!ci(r[e],t)||t===void 0&&!(e in r))&&oi(r,e,t)}var be=hi;function pi(r){return function(e,t,s){for(var i=-1,a=Object(e),n=s(e),o=n.length;o--;){var c=n[r?o:++i];if(t(a[c],c,a)===!1)break}return e}}var ui=pi,di=ui,li=di(),vi=li,V={exports:{}};(function(r,e){var t=C,s=e&&!e.nodeType&&e,i=s&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===s,n=a?t.Buffer:void 0,o=n?n.allocUnsafe:void 0;function c(u,d){if(d)return u.slice();var P=u.length,v=o?o(P):new u.constructor(P);return u.copy(v),v}r.exports=c})(V,V.exports);var fi=C,mi=fi.Uint8Array,gi=mi,_e=gi;function Pi(r){var e=new r.constructor(r.byteLength);return new _e(e).set(new _e(r)),e}var $i=Pi,bi=$i;function _i(r,e){var t=e?bi(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var wi=_i;function yi(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}var Ci=yi,Ii=b,we=Object.create,Oi=function(){function r(){}return function(e){if(!Ii(e))return{};if(we)return we(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Ai=Oi;function Hi(r,e){return function(t){return r(e(t))}}var Ei=Hi,ji=Ei,Si=ji(Object.getPrototypeOf,Object),ye=Si,Ni=Object.prototype;function Ti(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Ni;return r===t}var Ce=Ti,Di=Ai,qi=ye,Ri=Ce;function xi(r){return typeof r.constructor=="function"&&!Ri(r)?Di(qi(r)):{}}var Li=xi;function Ui(r){return r!=null&&typeof r=="object"}var E=Ui,Mi=D,Fi=E,Gi="[object Arguments]";function zi(r){return Fi(r)&&Mi(r)==Gi}var Ji=zi,Ie=Ji,ki=E,Oe=Object.prototype,Bi=Oe.hasOwnProperty,Vi=Oe.propertyIsEnumerable,Ki=Ie(function(){return arguments}())?Ie:function(r){return ki(r)&&Bi.call(r,"callee")&&!Vi.call(r,"callee")},Ae=Ki,Xi=Array.isArray,He=Xi,Wi=9007199254740991;function Yi(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Wi}var Ee=Yi,Zi=z,Qi=Ee;function ea(r){return r!=null&&Qi(r.length)&&!Zi(r)}var K=ea,ta=K,ra=E;function sa(r){return ra(r)&&ta(r)}var ia=sa,x={exports:{}};function aa(){return!1}var na=aa;(function(r,e){var t=C,s=na,i=e&&!e.nodeType&&e,a=i&&!0&&r&&!r.nodeType&&r,n=a&&a.exports===i,o=n?t.Buffer:void 0,c=o?o.isBuffer:void 0,u=c||s;r.exports=u})(x,x.exports);var oa=D,ca=ye,ha=E,pa="[object Object]",ua=Function.prototype,da=Object.prototype,je=ua.toString,la=da.hasOwnProperty,va=je.call(Object);function fa(r){if(!ha(r)||oa(r)!=pa)return!1;var e=ca(r);if(e===null)return!0;var t=la.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&je.call(t)==va}var ma=fa,ga=D,Pa=Ee,$a=E,ba="[object Arguments]",_a="[object Array]",wa="[object Boolean]",ya="[object Date]",Ca="[object Error]",Ia="[object Function]",Oa="[object Map]",Aa="[object Number]",Ha="[object Object]",Ea="[object RegExp]",ja="[object Set]",Sa="[object String]",Na="[object WeakMap]",Ta="[object ArrayBuffer]",Da="[object DataView]",qa="[object Float32Array]",Ra="[object Float64Array]",xa="[object Int8Array]",La="[object Int16Array]",Ua="[object Int32Array]",Ma="[object Uint8Array]",Fa="[object Uint8ClampedArray]",Ga="[object Uint16Array]",za="[object Uint32Array]",p={};p[qa]=p[Ra]=p[xa]=p[La]=p[Ua]=p[Ma]=p[Fa]=p[Ga]=p[za]=!0,p[ba]=p[_a]=p[Ta]=p[wa]=p[Da]=p[ya]=p[Ca]=p[Ia]=p[Oa]=p[Aa]=p[Ha]=p[Ea]=p[ja]=p[Sa]=p[Na]=!1;function Ja(r){return $a(r)&&Pa(r.length)&&!!p[ga(r)]}var ka=Ja;function Ba(r){return function(e){return r(e)}}var Va=Ba,X={exports:{}};(function(r,e){var t=ce,s=e&&!e.nodeType&&e,i=s&&!0&&r&&!r.nodeType&&r,a=i&&i.exports===s,n=a&&t.process,o=function(){try{var c=i&&i.require&&i.require("util").types;return c||n&&n.binding&&n.binding("util")}catch{}}();r.exports=o})(X,X.exports);var Ka=ka,Xa=Va,Se=X.exports,Ne=Se&&Se.isTypedArray,Wa=Ne?Xa(Ne):Ka,Te=Wa;function Ya(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var De=Ya,Za=B,Qa=S,en=Object.prototype,tn=en.hasOwnProperty;function rn(r,e,t){var s=r[e];(!(tn.call(r,e)&&Qa(s,t))||t===void 0&&!(e in r))&&Za(r,e,t)}var sn=rn,an=sn,nn=B;function on(r,e,t,s){var i=!t;t||(t={});for(var a=-1,n=e.length;++a<n;){var o=e[a],c=s?s(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),i?nn(t,o,c):an(t,o,c)}return t}var cn=on;function hn(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}var pn=hn,un=9007199254740991,dn=/^(?:0|[1-9]\d*)$/;function ln(r,e){var t=typeof r;return e=e??un,!!e&&(t=="number"||t!="symbol"&&dn.test(r))&&r>-1&&r%1==0&&r<e}var qe=ln,vn=pn,fn=Ae,mn=He,gn=x.exports,Pn=qe,$n=Te,bn=Object.prototype,_n=bn.hasOwnProperty;function wn(r,e){var t=mn(r),s=!t&&fn(r),i=!t&&!s&&gn(r),a=!t&&!s&&!i&&$n(r),n=t||s||i||a,o=n?vn(r.length,String):[],c=o.length;for(var u in r)(e||_n.call(r,u))&&!(n&&(u=="length"||i&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Pn(u,c)))&&o.push(u);return o}var yn=wn;function Cn(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var In=Cn,On=b,An=Ce,Hn=In,En=Object.prototype,jn=En.hasOwnProperty;function Sn(r){if(!On(r))return Hn(r);var e=An(r),t=[];for(var s in r)s=="constructor"&&(e||!jn.call(r,s))||t.push(s);return t}var Nn=Sn,Tn=yn,Dn=Nn,qn=K;function Rn(r){return qn(r)?Tn(r,!0):Dn(r)}var Re=Rn,xn=cn,Ln=Re;function Un(r){return xn(r,Ln(r))}var Mn=Un,xe=be,Fn=V.exports,Gn=wi,zn=Ci,Jn=Li,Le=Ae,Ue=He,kn=ia,Bn=x.exports,Vn=z,Kn=b,Xn=ma,Wn=Te,Me=De,Yn=Mn;function Zn(r,e,t,s,i,a,n){var o=Me(r,t),c=Me(e,t),u=n.get(c);if(u){xe(r,t,u);return}var d=a?a(o,c,t+"",r,e,n):void 0,P=d===void 0;if(P){var v=Ue(c),F=!v&&Bn(c),ee=!v&&!F&&Wn(c);d=c,v||F||ee?Ue(o)?d=o:kn(o)?d=zn(o):F?(P=!1,d=Fn(c,!0)):ee?(P=!1,d=Gn(c,!0)):d=[]:Xn(c)||Le(c)?(d=o,Le(o)?d=Yn(o):(!Kn(o)||Vn(o))&&(d=Jn(c))):P=!1}P&&(n.set(c,d),i(d,c,s,a,n),n.delete(c)),xe(r,t,d)}var Qn=Zn,eo=si,to=be,ro=vi,so=Qn,io=b,ao=Re,no=De;function Fe(r,e,t,s,i){r!==e&&ro(e,function(a,n){if(i||(i=new eo),io(a))so(r,e,n,t,Fe,s,i);else{var o=s?s(no(r,n),a,n+"",r,e,i):void 0;o===void 0&&(o=a),to(r,n,o)}},ao)}var oo=Fe;function co(r){return r}var Ge=co;function ho(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var po=ho,uo=po,ze=Math.max;function lo(r,e,t){return e=ze(e===void 0?r.length-1:e,0),function(){for(var s=arguments,i=-1,a=ze(s.length-e,0),n=Array(a);++i<a;)n[i]=s[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=s[i];return o[e]=t(n),uo(r,this,o)}}var vo=lo;function fo(r){return function(){return r}}var mo=fo,go=mo,Je=Pe,Po=Ge,$o=Je?function(r,e){return Je(r,"toString",{configurable:!0,enumerable:!1,value:go(e),writable:!0})}:Po,bo=$o,_o=800,wo=16,yo=Date.now;function Co(r){var e=0,t=0;return function(){var s=yo(),i=wo-(s-t);if(t=s,i>0){if(++e>=_o)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var Io=Co,Oo=bo,Ao=Io,Ho=Ao(Oo),Eo=Ho,jo=Ge,So=vo,No=Eo;function To(r,e){return No(So(r,e,jo),r+"")}var Do=To,qo=S,Ro=K,xo=qe,Lo=b;function Uo(r,e,t){if(!Lo(t))return!1;var s=typeof e;return(s=="number"?Ro(t)&&xo(e,t.length):s=="string"&&e in t)?qo(t[e],r):!1}var Mo=Uo,Fo=Do,Go=Mo;function zo(r){return Fo(function(e,t){var s=-1,i=t.length,a=i>1?t[i-1]:void 0,n=i>2?t[2]:void 0;for(a=r.length>3&&typeof a=="function"?(i--,a):void 0,n&&Go(t[0],t[1],n)&&(a=i<3?void 0:a,i=1),e=Object(e);++s<i;){var o=t[s];o&&r(e,o,s,a)}return e})}var Jo=zo,ko=oo,Bo=Jo,Vo=Bo(function(r,e,t){ko(r,e,t)}),Ko=Vo,Xo=Object.defineProperty,Wo=Object.defineProperties,Yo=Object.getOwnPropertyDescriptors,ke=Object.getOwnPropertySymbols,Zo=Object.prototype.hasOwnProperty,Qo=Object.prototype.propertyIsEnumerable,Be=(r,e,t)=>e in r?Xo(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,L=(r,e)=>{for(var t in e||(e={}))Zo.call(e,t)&&Be(r,t,e[t]);if(ke)for(var t of ke(e))Qo.call(e,t)&&Be(r,t,e[t]);return r},ec=(r,e)=>Wo(r,Yo(e));function f(r,e,t){var s;const i=l.parseChainId(r);return((s=e.rpcMap)==null?void 0:s[i.reference])||`${oe}?chainId=${i.namespace}:${i.reference}&projectId=${t}`}function _(r){return r.includes(":")?r.split(":")[1]:r}function Ve(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function tc(r,e){const t=Object.keys(e.namespaces).filter(i=>i.includes(r));if(!t.length)return[];const s=[];return t.forEach(i=>{const a=e.namespaces[i].accounts;s.push(...a)}),s}function W(r={},e={}){const t=Ke(r),s=Ke(e);return Ko(t,s)}function Ke(r){var e,t,s,i;const a={};if(!l.isValidObject(r))return a;for(const[n,o]of Object.entries(r)){const c=l.isCaipNamespace(n)?[n]:o.chains,u=o.methods||[],d=o.events||[],P=o.rpcMap||{},v=l.parseNamespaceKey(n);a[v]=ec(L(L({},a[v]),o),{chains:l.mergeArrays(c,(e=a[v])==null?void 0:e.chains),methods:l.mergeArrays(u,(t=a[v])==null?void 0:t.methods),events:l.mergeArrays(d,(s=a[v])==null?void 0:s.events),rpcMap:L(L({},P),(i=a[v])==null?void 0:i.rpcMap)})}return a}function rc(r){return r.includes(":")?r.split(":")[2]:r}function Xe(r){const e={};for(const[t,s]of Object.entries(r)){const i=s.methods||[],a=s.events||[],n=s.accounts||[],o=l.isCaipNamespace(t)?[t]:s.chains?s.chains:Ve(s.accounts);e[t]={chains:o,methods:i,events:a,accounts:n}}return e}function Y(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const We={},h=r=>We[r],Z=(r,e)=>{We[r]=e};class sc{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=_(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}var ic=Object.defineProperty,ac=Object.defineProperties,nc=Object.getOwnPropertyDescriptors,Ye=Object.getOwnPropertySymbols,oc=Object.prototype.hasOwnProperty,cc=Object.prototype.propertyIsEnumerable,Ze=(r,e,t)=>e in r?ic(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qe=(r,e)=>{for(var t in e||(e={}))oc.call(e,t)&&Ze(r,t,e[t]);if(Ye)for(var t of Ye(e))cc.call(e,t)&&Ze(r,t,e[t]);return r},et=(r,e)=>ac(r,nc(e));class hc{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const s=t||f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new se.HttpConnection(s,h("disableProviderPing")))}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=parseInt(_(t));e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,s;let i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const a=parseInt(i,16);if(this.isChainApproved(a))this.setDefaultChain(`${a}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${a}`);else throw new Error(`Failed to switch to chain 'eip155:${a}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,s,i;const a=(s=(t=e.request)==null?void 0:t.params)==null?void 0:s[0];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const n=this.client.session.get(e.topic),o=((i=n?.sessionProperties)==null?void 0:i.capabilities)||{};if(o!=null&&o[a])return o?.[a];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:et(Qe({},n.sessionProperties||{}),{capabilities:et(Qe({},o||{}),{[a]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,s;const i=this.client.session.get(e.topic),a=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(a){const o=this.getBundlerUrl(e.chainId,a);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const n=(s=i.sessionProperties)==null?void 0:s.bundler_url;if(n)try{return await this.getUserOperationReceipt(n,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,n)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var s;const i=new URL(e),a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie.formatJsonRpcRequest("eth_getUserOperationReceipt",[(s=t.request.params)==null?void 0:s[0]]))});if(!a.ok)throw new Error(`Failed to fetch user operation receipt - ${a.status}`);return await a.json()}getBundlerUrl(e,t){return`${ht}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}class pc{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=_(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class uc{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=_(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class dc{constructor(e){this.name="algorand",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const s=t||f(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class lc{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const s=this.getCardanoRPCUrl(t),i=_(t);e[i]=this.createHttpProvider(i,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class vc{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=_(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class fc{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=_(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class mc{constructor(e){this.name="near",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||f(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace);return typeof s>"u"?void 0:new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}class gc{constructor(e){this.name="tezos",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||f(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace);return typeof s>"u"?void 0:new g.JsonRpcProvider(new $.default(s))}}class Pc{constructor(e){this.name=w,this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(m.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const s={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(i=>{const a=l.parseChainId(i);s[`${a.namespace}:${a.reference}`]=this.createHttpProvider(i)}),s}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||f(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new g.JsonRpcProvider(new $.default(s,h("disableProviderPing")))}}var $c=Object.defineProperty,bc=Object.defineProperties,_c=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,wc=Object.prototype.hasOwnProperty,yc=Object.prototype.propertyIsEnumerable,rt=(r,e,t)=>e in r?$c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U=(r,e)=>{for(var t in e||(e={}))wc.call(e,t)&&rt(r,t,e[t]);if(tt)for(var t of tt(e))yc.call(e,t)&&rt(r,t,e[t]);return r},Q=(r,e)=>bc(r,_c(e));class M{constructor(e){this.events=new at.default,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:re.pino(re.getDefaultLoggerOptions({level:e?.logger||ae})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new M(e);return await t.initialize(),t}async request(e,t,s){const[i,a]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:U({},e),chainId:`${i}:${a}`,topic:this.session.topic,expiry:s})}sendAsync(e,t,s,i){const a=new Date().getTime();this.request(e,s,i).then(n=>t(null,ie.formatJsonRpcResult(a,n))).catch(n=>t(n,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:l.getSdkError("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:i}=await this.client.authenticate(e,t);s&&(this.uri=s,this.events.emit("display_uri",s));const a=await i();if(this.session=a.session,this.session){const n=Xe(this.session.namespaces);this.namespaces=W(this.namespaces,n),this.persist("namespaces",this.namespaces),this.onConnect()}return a}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await i().then(a=>{this.session=a;const n=Xe(a.namespaces);this.namespaces=W(this.namespaces,n),this.persist("namespaces",this.namespaces)}).catch(a=>{if(a.message!==te.PROPOSAL_EXPIRY_MESSAGE)throw a;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[s,i]=this.validateChain(e),a=this.getProvider(s);a.name===w?a.setDefaultChain(`${s}:${i}`,t):a.setDefaultChain(i,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(l.isValidArray(t)){for(const s of t)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await it.default.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ae,relayUrl:this.providerOpts.relayUrl||nt,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>l.parseNamespaceKey(t)))];Z("client",this.client),Z("events",this.events),Z("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const s=tc(t,this.session),i=Ve(s),a=W(this.namespaces,this.optionalNamespaces),n=Q(U({},a[t]),{accounts:s,chains:i});switch(t){case"eip155":this.rpcProviders[t]=new hc({namespace:n});break;case"algorand":this.rpcProviders[t]=new dc({namespace:n});break;case"solana":this.rpcProviders[t]=new pc({namespace:n});break;case"cosmos":this.rpcProviders[t]=new uc({namespace:n});break;case"polkadot":this.rpcProviders[t]=new sc({namespace:n});break;case"cip34":this.rpcProviders[t]=new lc({namespace:n});break;case"elrond":this.rpcProviders[t]=new vc({namespace:n});break;case"multiversx":this.rpcProviders[t]=new fc({namespace:n});break;case"near":this.rpcProviders[t]=new mc({namespace:n});break;case"tezos":this.rpcProviders[t]=new gc({namespace:n});break;default:this.rpcProviders[w]?this.rpcProviders[w].updateNamespace(n):this.rpcProviders[w]=new Pc({namespace:n})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:s}=t;if(s.name==="accountsChanged"){const i=s.data;i&&l.isValidArray(i)&&this.events.emit("accountsChanged",i.map(rc))}else if(s.name==="chainChanged"){const i=t.chainId,a=t.event.data,n=l.parseNamespaceKey(i),o=Y(i)!==Y(a)?`${n}:${Y(a)}`:i;this.onChainChanged(o)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var s;const{namespaces:i}=t,a=(s=this.client)==null?void 0:s.session.get(e);this.session=Q(U({},a),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Q(U({},l.getSdkError("USER_DISCONNECTED")),{data:e.topic}))}),this.on(m.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[w]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:s,sessionProperties:i}=e;t&&Object.keys(t).length&&(this.namespaces=t),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=i,this.persist("namespaces",t),this.persist("optionalNamespaces",s)}validateChain(e){const[t,s]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(n=>l.parseNamespaceKey(n)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];const i=l.parseNamespaceKey(Object.keys(this.namespaces)[0]),a=this.rpcProviders[i].getDefaultChain();return[i,a]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[s,i]=this.validateChain(e);i&&(t||this.getProvider(s).setDefaultChain(i),this.namespaces[s]?this.namespaces[s].defaultChain=i:this.namespaces[`${s}:${i}`]?this.namespaces[`${s}:${i}`].defaultChain=i:this.namespaces[`${s}:${i}`]={defaultChain:i},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",i))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${ne}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${ne}/${e}`)}}const Cc=M;exports.UniversalProvider=Cc,exports.default=M;
//# sourceMappingURL=index.cjs.js.map
