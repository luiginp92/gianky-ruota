import st,{PROPOSAL_EXPIRY_MESSAGE as it}from"@walletconnect/sign-client";import{isValidObject as nt,isCaipNamespace as te,parseNamespaceKey as A,mergeArrays as G,parseChainId as re,getSdkError as se,isValidArray as ie}from"@walletconnect/utils";import{pino as at,getDefaultLoggerOptions as ot}from"@walletconnect/logger";import P,{HttpConnection as ct}from"@walletconnect/jsonrpc-http-connection";import{JsonRpcProvider as m}from"@walletconnect/jsonrpc-provider";import{formatJsonRpcRequest as ht,formatJsonRpcResult as pt}from"@walletconnect/jsonrpc-utils";import ut from"events";const ne="error",dt="wss://relay.walletconnect.org",lt="wc",vt="universal_provider",ae=`${lt}@2:${vt}:`,oe="https://rpc.walletconnect.org/v1/",w="generic",ft=`${oe}bundler`,f={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mt(){this.__data__=[],this.size=0}var gt=mt;function Pt(r,e){return r===e||r!==r&&e!==e}var S=Pt,$t=S;function bt(r,e){for(var t=r.length;t--;)if($t(r[t][0],e))return t;return-1}var N=bt,wt=N,_t=Array.prototype,Ct=_t.splice;function yt(r){var e=this.__data__,t=wt(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():Ct.call(e,t,1),--this.size,!0}var It=yt,Ot=N;function At(r){var e=this.__data__,t=Ot(e,r);return t<0?void 0:e[t][1]}var Ht=At,Et=N;function jt(r){return Et(this.__data__,r)>-1}var St=jt,Nt=N;function Tt(r,e){var t=this.__data__,s=Nt(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}var Dt=Tt,qt=gt,Rt=It,xt=Ht,Lt=St,Ut=Dt;function _(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}_.prototype.clear=qt,_.prototype.delete=Rt,_.prototype.get=xt,_.prototype.has=Lt,_.prototype.set=Ut;var T=_,Mt=T;function Ft(){this.__data__=new Mt,this.size=0}var Gt=Ft;function zt(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var kt=zt;function Bt(r){return this.__data__.get(r)}var Vt=Bt;function Jt(r){return this.__data__.has(r)}var Kt=Jt,Xt=typeof j=="object"&&j&&j.Object===Object&&j,ce=Xt,Wt=ce,Yt=typeof self=="object"&&self&&self.Object===Object&&self,Zt=Wt||Yt||Function("return this")(),C=Zt,Qt=C,er=Qt.Symbol,he=er,pe=he,ue=Object.prototype,tr=ue.hasOwnProperty,rr=ue.toString,H=pe?pe.toStringTag:void 0;function sr(r){var e=tr.call(r,H),t=r[H];try{r[H]=void 0;var s=!0}catch{}var i=rr.call(r);return s&&(e?r[H]=t:delete r[H]),i}var ir=sr,nr=Object.prototype,ar=nr.toString;function or(r){return ar.call(r)}var cr=or,de=he,hr=ir,pr=cr,ur="[object Null]",dr="[object Undefined]",le=de?de.toStringTag:void 0;function lr(r){return r==null?r===void 0?dr:ur:le&&le in Object(r)?hr(r):pr(r)}var D=lr;function vr(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var $=vr,fr=D,mr=$,gr="[object AsyncFunction]",Pr="[object Function]",$r="[object GeneratorFunction]",br="[object Proxy]";function wr(r){if(!mr(r))return!1;var e=fr(r);return e==Pr||e==$r||e==gr||e==br}var z=wr,_r=C,Cr=_r["__core-js_shared__"],yr=Cr,k=yr,ve=function(){var r=/[^.]+$/.exec(k&&k.keys&&k.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function Ir(r){return!!ve&&ve in r}var Or=Ir,Ar=Function.prototype,Hr=Ar.toString;function Er(r){if(r!=null){try{return Hr.call(r)}catch{}try{return r+""}catch{}}return""}var jr=Er,Sr=z,Nr=Or,Tr=$,Dr=jr,qr=/[\\^$.*+?()[\]{}|]/g,Rr=/^\[object .+?Constructor\]$/,xr=Function.prototype,Lr=Object.prototype,Ur=xr.toString,Mr=Lr.hasOwnProperty,Fr=RegExp("^"+Ur.call(Mr).replace(qr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Gr(r){if(!Tr(r)||Nr(r))return!1;var e=Sr(r)?Fr:Rr;return e.test(Dr(r))}var zr=Gr;function kr(r,e){return r?.[e]}var Br=kr,Vr=zr,Jr=Br;function Kr(r,e){var t=Jr(r,e);return Vr(t)?t:void 0}var B=Kr,Xr=B,Wr=C,Yr=Xr(Wr,"Map"),fe=Yr,Zr=B,Qr=Zr(Object,"create"),q=Qr,me=q;function es(){this.__data__=me?me(null):{},this.size=0}var ts=es;function rs(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var ss=rs,is=q,ns="__lodash_hash_undefined__",as=Object.prototype,os=as.hasOwnProperty;function cs(r){var e=this.__data__;if(is){var t=e[r];return t===ns?void 0:t}return os.call(e,r)?e[r]:void 0}var hs=cs,ps=q,us=Object.prototype,ds=us.hasOwnProperty;function ls(r){var e=this.__data__;return ps?e[r]!==void 0:ds.call(e,r)}var vs=ls,fs=q,ms="__lodash_hash_undefined__";function gs(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=fs&&e===void 0?ms:e,this}var Ps=gs,$s=ts,bs=ss,ws=hs,_s=vs,Cs=Ps;function y(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}y.prototype.clear=$s,y.prototype.delete=bs,y.prototype.get=ws,y.prototype.has=_s,y.prototype.set=Cs;var ys=y,ge=ys,Is=T,Os=fe;function As(){this.size=0,this.__data__={hash:new ge,map:new(Os||Is),string:new ge}}var Hs=As;function Es(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var js=Es,Ss=js;function Ns(r,e){var t=r.__data__;return Ss(e)?t[typeof e=="string"?"string":"hash"]:t.map}var R=Ns,Ts=R;function Ds(r){var e=Ts(this,r).delete(r);return this.size-=e?1:0,e}var qs=Ds,Rs=R;function xs(r){return Rs(this,r).get(r)}var Ls=xs,Us=R;function Ms(r){return Us(this,r).has(r)}var Fs=Ms,Gs=R;function zs(r,e){var t=Gs(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}var ks=zs,Bs=Hs,Vs=qs,Js=Ls,Ks=Fs,Xs=ks;function I(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}I.prototype.clear=Bs,I.prototype.delete=Vs,I.prototype.get=Js,I.prototype.has=Ks,I.prototype.set=Xs;var Ws=I,Ys=T,Zs=fe,Qs=Ws,ei=200;function ti(r,e){var t=this.__data__;if(t instanceof Ys){var s=t.__data__;if(!Zs||s.length<ei-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new Qs(s)}return t.set(r,e),this.size=t.size,this}var ri=ti,si=T,ii=Gt,ni=kt,ai=Vt,oi=Kt,ci=ri;function O(r){var e=this.__data__=new si(r);this.size=e.size}O.prototype.clear=ii,O.prototype.delete=ni,O.prototype.get=ai,O.prototype.has=oi,O.prototype.set=ci;var hi=O,pi=B,ui=function(){try{var r=pi(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Pe=ui,$e=Pe;function di(r,e,t){e=="__proto__"&&$e?$e(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var V=di,li=V,vi=S;function fi(r,e,t){(t!==void 0&&!vi(r[e],t)||t===void 0&&!(e in r))&&li(r,e,t)}var be=fi;function mi(r){return function(e,t,s){for(var i=-1,n=Object(e),a=s(e),o=a.length;o--;){var c=a[r?o:++i];if(t(n[c],c,n)===!1)break}return e}}var gi=mi,Pi=gi,$i=Pi(),bi=$i,J={exports:{}};(function(r,e){var t=C,s=e&&!e.nodeType&&e,i=s&&!0&&r&&!r.nodeType&&r,n=i&&i.exports===s,a=n?t.Buffer:void 0,o=a?a.allocUnsafe:void 0;function c(u,d){if(d)return u.slice();var g=u.length,l=o?o(g):new u.constructor(g);return u.copy(l),l}r.exports=c})(J,J.exports);var wi=C,_i=wi.Uint8Array,Ci=_i,we=Ci;function yi(r){var e=new r.constructor(r.byteLength);return new we(e).set(new we(r)),e}var Ii=yi,Oi=Ii;function Ai(r,e){var t=e?Oi(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var Hi=Ai;function Ei(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}var ji=Ei,Si=$,_e=Object.create,Ni=function(){function r(){}return function(e){if(!Si(e))return{};if(_e)return _e(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),Ti=Ni;function Di(r,e){return function(t){return r(e(t))}}var qi=Di,Ri=qi,xi=Ri(Object.getPrototypeOf,Object),Ce=xi,Li=Object.prototype;function Ui(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Li;return r===t}var ye=Ui,Mi=Ti,Fi=Ce,Gi=ye;function zi(r){return typeof r.constructor=="function"&&!Gi(r)?Mi(Fi(r)):{}}var ki=zi;function Bi(r){return r!=null&&typeof r=="object"}var E=Bi,Vi=D,Ji=E,Ki="[object Arguments]";function Xi(r){return Ji(r)&&Vi(r)==Ki}var Wi=Xi,Ie=Wi,Yi=E,Oe=Object.prototype,Zi=Oe.hasOwnProperty,Qi=Oe.propertyIsEnumerable,en=Ie(function(){return arguments}())?Ie:function(r){return Yi(r)&&Zi.call(r,"callee")&&!Qi.call(r,"callee")},Ae=en,tn=Array.isArray,He=tn,rn=9007199254740991;function sn(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=rn}var Ee=sn,nn=z,an=Ee;function on(r){return r!=null&&an(r.length)&&!nn(r)}var K=on,cn=K,hn=E;function pn(r){return hn(r)&&cn(r)}var un=pn,x={exports:{}};function dn(){return!1}var ln=dn;(function(r,e){var t=C,s=ln,i=e&&!e.nodeType&&e,n=i&&!0&&r&&!r.nodeType&&r,a=n&&n.exports===i,o=a?t.Buffer:void 0,c=o?o.isBuffer:void 0,u=c||s;r.exports=u})(x,x.exports);var vn=D,fn=Ce,mn=E,gn="[object Object]",Pn=Function.prototype,$n=Object.prototype,je=Pn.toString,bn=$n.hasOwnProperty,wn=je.call(Object);function _n(r){if(!mn(r)||vn(r)!=gn)return!1;var e=fn(r);if(e===null)return!0;var t=bn.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&je.call(t)==wn}var Cn=_n,yn=D,In=Ee,On=E,An="[object Arguments]",Hn="[object Array]",En="[object Boolean]",jn="[object Date]",Sn="[object Error]",Nn="[object Function]",Tn="[object Map]",Dn="[object Number]",qn="[object Object]",Rn="[object RegExp]",xn="[object Set]",Ln="[object String]",Un="[object WeakMap]",Mn="[object ArrayBuffer]",Fn="[object DataView]",Gn="[object Float32Array]",zn="[object Float64Array]",kn="[object Int8Array]",Bn="[object Int16Array]",Vn="[object Int32Array]",Jn="[object Uint8Array]",Kn="[object Uint8ClampedArray]",Xn="[object Uint16Array]",Wn="[object Uint32Array]",p={};p[Gn]=p[zn]=p[kn]=p[Bn]=p[Vn]=p[Jn]=p[Kn]=p[Xn]=p[Wn]=!0,p[An]=p[Hn]=p[Mn]=p[En]=p[Fn]=p[jn]=p[Sn]=p[Nn]=p[Tn]=p[Dn]=p[qn]=p[Rn]=p[xn]=p[Ln]=p[Un]=!1;function Yn(r){return On(r)&&In(r.length)&&!!p[yn(r)]}var Zn=Yn;function Qn(r){return function(e){return r(e)}}var ea=Qn,X={exports:{}};(function(r,e){var t=ce,s=e&&!e.nodeType&&e,i=s&&!0&&r&&!r.nodeType&&r,n=i&&i.exports===s,a=n&&t.process,o=function(){try{var c=i&&i.require&&i.require("util").types;return c||a&&a.binding&&a.binding("util")}catch{}}();r.exports=o})(X,X.exports);var ta=Zn,ra=ea,Se=X.exports,Ne=Se&&Se.isTypedArray,sa=Ne?ra(Ne):ta,Te=sa;function ia(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var De=ia,na=V,aa=S,oa=Object.prototype,ca=oa.hasOwnProperty;function ha(r,e,t){var s=r[e];(!(ca.call(r,e)&&aa(s,t))||t===void 0&&!(e in r))&&na(r,e,t)}var pa=ha,ua=pa,da=V;function la(r,e,t,s){var i=!t;t||(t={});for(var n=-1,a=e.length;++n<a;){var o=e[n],c=s?s(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),i?da(t,o,c):ua(t,o,c)}return t}var va=la;function fa(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}var ma=fa,ga=9007199254740991,Pa=/^(?:0|[1-9]\d*)$/;function $a(r,e){var t=typeof r;return e=e??ga,!!e&&(t=="number"||t!="symbol"&&Pa.test(r))&&r>-1&&r%1==0&&r<e}var qe=$a,ba=ma,wa=Ae,_a=He,Ca=x.exports,ya=qe,Ia=Te,Oa=Object.prototype,Aa=Oa.hasOwnProperty;function Ha(r,e){var t=_a(r),s=!t&&wa(r),i=!t&&!s&&Ca(r),n=!t&&!s&&!i&&Ia(r),a=t||s||i||n,o=a?ba(r.length,String):[],c=o.length;for(var u in r)(e||Aa.call(r,u))&&!(a&&(u=="length"||i&&(u=="offset"||u=="parent")||n&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||ya(u,c)))&&o.push(u);return o}var Ea=Ha;function ja(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var Sa=ja,Na=$,Ta=ye,Da=Sa,qa=Object.prototype,Ra=qa.hasOwnProperty;function xa(r){if(!Na(r))return Da(r);var e=Ta(r),t=[];for(var s in r)s=="constructor"&&(e||!Ra.call(r,s))||t.push(s);return t}var La=xa,Ua=Ea,Ma=La,Fa=K;function Ga(r){return Fa(r)?Ua(r,!0):Ma(r)}var Re=Ga,za=va,ka=Re;function Ba(r){return za(r,ka(r))}var Va=Ba,xe=be,Ja=J.exports,Ka=Hi,Xa=ji,Wa=ki,Le=Ae,Ue=He,Ya=un,Za=x.exports,Qa=z,eo=$,to=Cn,ro=Te,Me=De,so=Va;function io(r,e,t,s,i,n,a){var o=Me(r,t),c=Me(e,t),u=a.get(c);if(u){xe(r,t,u);return}var d=n?n(o,c,t+"",r,e,a):void 0,g=d===void 0;if(g){var l=Ue(c),F=!l&&Za(c),ee=!l&&!F&&ro(c);d=c,l||F||ee?Ue(o)?d=o:Ya(o)?d=Xa(o):F?(g=!1,d=Ja(c,!0)):ee?(g=!1,d=Ka(c,!0)):d=[]:to(c)||Le(c)?(d=o,Le(o)?d=so(o):(!eo(o)||Qa(o))&&(d=Wa(c))):g=!1}g&&(a.set(c,d),i(d,c,s,n,a),a.delete(c)),xe(r,t,d)}var no=io,ao=hi,oo=be,co=bi,ho=no,po=$,uo=Re,lo=De;function Fe(r,e,t,s,i){r!==e&&co(e,function(n,a){if(i||(i=new ao),po(n))ho(r,e,a,t,Fe,s,i);else{var o=s?s(lo(r,a),n,a+"",r,e,i):void 0;o===void 0&&(o=n),oo(r,a,o)}},uo)}var vo=Fe;function fo(r){return r}var Ge=fo;function mo(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}var go=mo,Po=go,ze=Math.max;function $o(r,e,t){return e=ze(e===void 0?r.length-1:e,0),function(){for(var s=arguments,i=-1,n=ze(s.length-e,0),a=Array(n);++i<n;)a[i]=s[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=s[i];return o[e]=t(a),Po(r,this,o)}}var bo=$o;function wo(r){return function(){return r}}var _o=wo,Co=_o,ke=Pe,yo=Ge,Io=ke?function(r,e){return ke(r,"toString",{configurable:!0,enumerable:!1,value:Co(e),writable:!0})}:yo,Oo=Io,Ao=800,Ho=16,Eo=Date.now;function jo(r){var e=0,t=0;return function(){var s=Eo(),i=Ho-(s-t);if(t=s,i>0){if(++e>=Ao)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}var So=jo,No=Oo,To=So,Do=To(No),qo=Do,Ro=Ge,xo=bo,Lo=qo;function Uo(r,e){return Lo(xo(r,e,Ro),r+"")}var Mo=Uo,Fo=S,Go=K,zo=qe,ko=$;function Bo(r,e,t){if(!ko(t))return!1;var s=typeof e;return(s=="number"?Go(t)&&zo(e,t.length):s=="string"&&e in t)?Fo(t[e],r):!1}var Vo=Bo,Jo=Mo,Ko=Vo;function Xo(r){return Jo(function(e,t){var s=-1,i=t.length,n=i>1?t[i-1]:void 0,a=i>2?t[2]:void 0;for(n=r.length>3&&typeof n=="function"?(i--,n):void 0,a&&Ko(t[0],t[1],a)&&(n=i<3?void 0:n,i=1),e=Object(e);++s<i;){var o=t[s];o&&r(e,o,s,n)}return e})}var Wo=Xo,Yo=vo,Zo=Wo,Qo=Zo(function(r,e,t){Yo(r,e,t)}),ec=Qo,tc=Object.defineProperty,rc=Object.defineProperties,sc=Object.getOwnPropertyDescriptors,Be=Object.getOwnPropertySymbols,ic=Object.prototype.hasOwnProperty,nc=Object.prototype.propertyIsEnumerable,Ve=(r,e,t)=>e in r?tc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,L=(r,e)=>{for(var t in e||(e={}))ic.call(e,t)&&Ve(r,t,e[t]);if(Be)for(var t of Be(e))nc.call(e,t)&&Ve(r,t,e[t]);return r},ac=(r,e)=>rc(r,sc(e));function v(r,e,t){var s;const i=re(r);return((s=e.rpcMap)==null?void 0:s[i.reference])||`${oe}?chainId=${i.namespace}:${i.reference}&projectId=${t}`}function b(r){return r.includes(":")?r.split(":")[1]:r}function Je(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function oc(r,e){const t=Object.keys(e.namespaces).filter(i=>i.includes(r));if(!t.length)return[];const s=[];return t.forEach(i=>{const n=e.namespaces[i].accounts;s.push(...n)}),s}function W(r={},e={}){const t=Ke(r),s=Ke(e);return ec(t,s)}function Ke(r){var e,t,s,i;const n={};if(!nt(r))return n;for(const[a,o]of Object.entries(r)){const c=te(a)?[a]:o.chains,u=o.methods||[],d=o.events||[],g=o.rpcMap||{},l=A(a);n[l]=ac(L(L({},n[l]),o),{chains:G(c,(e=n[l])==null?void 0:e.chains),methods:G(u,(t=n[l])==null?void 0:t.methods),events:G(d,(s=n[l])==null?void 0:s.events),rpcMap:L(L({},g),(i=n[l])==null?void 0:i.rpcMap)})}return n}function cc(r){return r.includes(":")?r.split(":")[2]:r}function Xe(r){const e={};for(const[t,s]of Object.entries(r)){const i=s.methods||[],n=s.events||[],a=s.accounts||[],o=te(t)?[t]:s.chains?s.chains:Je(s.accounts);e[t]={chains:o,methods:i,events:n,accounts:a}}return e}function Y(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}const We={},h=r=>We[r],Z=(r,e)=>{We[r]=e};class hc{constructor(e){this.name="polkadot",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=b(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}var pc=Object.defineProperty,uc=Object.defineProperties,dc=Object.getOwnPropertyDescriptors,Ye=Object.getOwnPropertySymbols,lc=Object.prototype.hasOwnProperty,vc=Object.prototype.propertyIsEnumerable,Ze=(r,e,t)=>e in r?pc(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Qe=(r,e)=>{for(var t in e||(e={}))lc.call(e,t)&&Ze(r,t,e[t]);if(Ye)for(var t of Ye(e))vc.call(e,t)&&Ze(r,t,e[t]);return r},et=(r,e)=>uc(r,dc(e));class fc{constructor(e){this.name="eip155",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t),this.chainId=parseInt(e),this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const s=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new ct(s,h("disableProviderPing")))}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=parseInt(b(t));e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(){const e=this.chainId,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}async handleSwitchChain(e){var t,s;let i=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const n=parseInt(i,16);if(this.isChainApproved(n))this.setDefaultChain(`${n}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${n}`);else throw new Error(`Failed to switch to chain 'eip155:${n}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,s,i;const n=(s=(t=e.request)==null?void 0:t.params)==null?void 0:s[0];if(!n)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const a=this.client.session.get(e.topic),o=((i=a?.sessionProperties)==null?void 0:i.capabilities)||{};if(o!=null&&o[n])return o?.[n];const c=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:et(Qe({},a.sessionProperties||{}),{capabilities:et(Qe({},o||{}),{[n]:c})})})}catch(u){console.warn("Failed to update session with capabilities",u)}return c}async getCallStatus(e){var t,s;const i=this.client.session.get(e.topic),n=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(n){const o=this.getBundlerUrl(e.chainId,n);try{return await this.getUserOperationReceipt(o,e)}catch(c){console.warn("Failed to fetch call status from bundler",c,o)}}const a=(s=i.sessionProperties)==null?void 0:s.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(o){console.warn("Failed to fetch call status from custom bundler",o,a)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var s;const i=new URL(e),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ht("eth_getUserOperationReceipt",[(s=t.request.params)==null?void 0:s[0]]))});if(!n.ok)throw new Error(`Failed to fetch user operation receipt - ${n.status}`);return await n.json()}getBundlerUrl(e,t){return`${ft}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}}class mc{constructor(e){this.name="solana",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=b(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}class gc{constructor(e){this.name="cosmos",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=b(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}class Pc{constructor(e){this.name="algorand",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(!this.httpProviders[e]){const s=t||v(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new m(new P(s,h("disableProviderPing")))}}class $c{constructor(e){this.name="cip34",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{const s=this.getCardanoRPCUrl(t),i=b(t);e[i]=this.createHttpProvider(i,s)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}getCardanoRPCUrl(e){const t=this.namespace.rpcMap;if(t)return t[e]}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||this.getCardanoRPCUrl(e);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}class bc{constructor(e){this.name="elrond",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=b(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}class wc{constructor(e){this.name="multiversx",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;const i=b(t);e[i]=this.createHttpProvider(i,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}class _c{constructor(e){this.name="near",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||v(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var s;e[t]=this.createHttpProvider(t,(s=this.namespace.rpcMap)==null?void 0:s[t])}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace);return typeof s>"u"?void 0:new m(new P(s,h("disableProviderPing")))}}class Cc{constructor(e){this.name="tezos",this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider().request(e.request)}setDefaultChain(e,t){if(this.chainId=e,!this.httpProviders[e]){const s=t||v(`${this.name}:${e}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);this.setHttpProvider(e,s)}this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const e=this.namespace.accounts;return e?e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2])||[]:[]}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{e[t]=this.createHttpProvider(t)}),e}getHttpProvider(){const e=`${this.name}:${this.chainId}`,t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace);return typeof s>"u"?void 0:new m(new P(s))}}class yc{constructor(e){this.name=w,this.namespace=e.namespace,this.events=h("events"),this.client=h("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t),this.chainId=e,this.events.emit(f.DEFAULT_CHAIN_CHANGED,`${this.name}:${e}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const s={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(i=>{const n=re(i);s[`${n.namespace}:${n.reference}`]=this.createHttpProvider(i)}),s}getHttpProvider(e){const t=this.httpProviders[e];if(typeof t>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return t}setHttpProvider(e,t){const s=this.createHttpProvider(e,t);s&&(this.httpProviders[e]=s)}createHttpProvider(e,t){const s=t||v(e,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${e}`);return new m(new P(s,h("disableProviderPing")))}}var Ic=Object.defineProperty,Oc=Object.defineProperties,Ac=Object.getOwnPropertyDescriptors,tt=Object.getOwnPropertySymbols,Hc=Object.prototype.hasOwnProperty,Ec=Object.prototype.propertyIsEnumerable,rt=(r,e,t)=>e in r?Ic(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,U=(r,e)=>{for(var t in e||(e={}))Hc.call(e,t)&&rt(r,t,e[t]);if(tt)for(var t of tt(e))Ec.call(e,t)&&rt(r,t,e[t]);return r},Q=(r,e)=>Oc(r,Ac(e));class M{constructor(e){this.events=new ut,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=e,this.logger=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:at(ot({level:e?.logger||ne})),this.disableProviderPing=e?.disableProviderPing||!1}static async init(e){const t=new M(e);return await t.initialize(),t}async request(e,t,s){const[i,n]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:U({},e),chainId:`${i}:${n}`,topic:this.session.topic,expiry:s})}sendAsync(e,t,s,i){const n=new Date().getTime();this.request(e,s,i).then(a=>t(null,pt(n,a))).catch(a=>t(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:se("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),await this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:s,response:i}=await this.client.authenticate(e,t);s&&(this.uri=s,this.events.emit("display_uri",s));const n=await i();if(this.session=n.session,this.session){const a=Xe(this.session.namespaces);this.namespaces=W(this.namespaces,a),this.persist("namespaces",this.namespaces),this.onConnect()}return n}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){this.shouldAbortPairingAttempt=!1;let t=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(t>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:i}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await i().then(n=>{this.session=n;const a=Xe(n.namespaces);this.namespaces=W(this.namespaces,a),this.persist("namespaces",this.namespaces)}).catch(n=>{if(n.message!==it)throw n;t++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[s,i]=this.validateChain(e),n=this.getProvider(s);n.name===w?n.setDefaultChain(`${s}:${i}`,t):n.setDefaultChain(i,t)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(e={}){this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(ie(t)){for(const s of t)e.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const e=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[e]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await st.init({core:this.providerOpts.core,logger:this.providerOpts.logger||ne,relayUrl:this.providerOpts.relayUrl||dt,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>A(t)))];Z("client",this.client),Z("events",this.events),Z("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const s=oc(t,this.session),i=Je(s),n=W(this.namespaces,this.optionalNamespaces),a=Q(U({},n[t]),{accounts:s,chains:i});switch(t){case"eip155":this.rpcProviders[t]=new fc({namespace:a});break;case"algorand":this.rpcProviders[t]=new Pc({namespace:a});break;case"solana":this.rpcProviders[t]=new mc({namespace:a});break;case"cosmos":this.rpcProviders[t]=new gc({namespace:a});break;case"polkadot":this.rpcProviders[t]=new hc({namespace:a});break;case"cip34":this.rpcProviders[t]=new $c({namespace:a});break;case"elrond":this.rpcProviders[t]=new bc({namespace:a});break;case"multiversx":this.rpcProviders[t]=new wc({namespace:a});break;case"near":this.rpcProviders[t]=new _c({namespace:a});break;case"tezos":this.rpcProviders[t]=new Cc({namespace:a});break;default:this.rpcProviders[w]?this.rpcProviders[w].updateNamespace(a):this.rpcProviders[w]=new yc({namespace:a})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{const{params:t}=e,{event:s}=t;if(s.name==="accountsChanged"){const i=s.data;i&&ie(i)&&this.events.emit("accountsChanged",i.map(cc))}else if(s.name==="chainChanged"){const i=t.chainId,n=t.event.data,a=A(i),o=Y(i)!==Y(n)?`${a}:${Y(n)}`:i;this.onChainChanged(o)}else this.events.emit(s.name,s.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var s;const{namespaces:i}=t,n=(s=this.client)==null?void 0:s.session.get(e);this.session=Q(U({},n),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Q(U({},se("USER_DISCONNECTED")),{data:e.topic}))}),this.on(f.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(e,!0)})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[w]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t,optionalNamespaces:s,sessionProperties:i}=e;t&&Object.keys(t).length&&(this.namespaces=t),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=i,this.persist("namespaces",t),this.persist("optionalNamespaces",s)}validateChain(e){const[t,s]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,s];if(t&&!Object.keys(this.namespaces||{}).map(a=>A(a)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&s)return[t,s];const i=A(Object.keys(this.namespaces)[0]),n=this.rpcProviders[i].getDefaultChain();return[i,n]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}onChainChanged(e,t=!1){if(!this.namespaces)return;const[s,i]=this.validateChain(e);i&&(t||this.getProvider(s).setDefaultChain(i),this.namespaces[s]?this.namespaces[s].defaultChain=i:this.namespaces[`${s}:${i}`]?this.namespaces[`${s}:${i}`].defaultChain=i:this.namespaces[`${s}:${i}`]={defaultChain:i},this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",i))}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(e,t){this.client.core.storage.setItem(`${ae}/${e}`,t)}async getFromStore(e){return await this.client.core.storage.getItem(`${ae}/${e}`)}}const jc=M;export{jc as UniversalProvider,M as default};
//# sourceMappingURL=index.es.js.map
